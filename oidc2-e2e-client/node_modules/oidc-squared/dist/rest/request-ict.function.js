"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.requestIct = void 0;
const http_request_function_type_1 = require("./types/http-request-function.type");
/**
 * Requests an Identity Certification Token.
 * @param options ICT Request Options.
 * @param http Optional HTTP Request function. Default is fetch.
 * @returns ICT Response containing the ICT.
 */
async function requestIct(options, http = http_request_function_type_1.FETCH_HTTP_REQUEST_FUNCTION) {
    // Request ICT.
    const result = await http('POST', options.ictEndpoint, new Headers({
        'Authorization': `bearer ${options.accessToken}`,
        'Content-Type': 'application/jwt+pop',
    }), options.popToken);
    // Return result or throw error.
    switch (result.responseCode) {
        case 201:
            return JSON.parse(result.body);
        case 401:
            throw new Error('Unauthorized to request an ICT');
        default:
            throw new Error('Failed to request ICT for unknown reasons');
    }
}
exports.requestIct = requestIct;
//# sourceMappingURL=request-ict.function.js.map